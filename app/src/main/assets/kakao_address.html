<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ì£¼ì†Œê²€ìƒ‰</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #wrap {
            width: 100%;
            height: 100%;
        }
    </style>
    <!-- Kakao ì§€ë„ API (ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ í¬í•¨) -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ðŸ”‘106b1a3fbc307c99977a744210efa224&libraries=services"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>
<div id="wrap"></div>

<script>
    // AndroidInterface ê°ì²´ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¤í–‰
    function waitForAndroidInterface(callback, retries = 10, delay = 300) {
        if (window.AndroidInterface && AndroidInterface.onAddressSelected) {
            callback();
        } else if (retries > 0) {
            setTimeout(() => {
                waitForAndroidInterface(callback, retries - 1, delay);
            }, delay);
        } else {
            alert("Android ì—°ë™ ì‹¤íŒ¨: ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    // Androidë¡œ ì£¼ì†Œ + ì¢Œí‘œ ì „ì†¡
    function sendToAndroid(address, lat, lng) {
        if (window.AndroidInterface && AndroidInterface.onAddressSelected) {
            AndroidInterface.onAddressSelected(address, lat.toString(), lng.toString());
        }
    }

    // íŽ˜ì´ì§€ ë¡œë”© ì‹œ ì£¼ì†Œ ê²€ìƒ‰ì°½ ì‹¤í–‰
    window.onload = function () {
        new daum.Postcode({
            oncomplete: function(data) {
                var fullAddr = data.roadAddress || data.address;
                var geocoder = new kakao.maps.services.Geocoder();

                // ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ ìš”ì²­
                geocoder.addressSearch(fullAddr, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var lat = result[0].y;
                        var lng = result[0].x;

                        waitForAndroidInterface(() => {
                            sendToAndroid(fullAddr, lat, lng);
                        });
                    } else {
                        alert("ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                        waitForAndroidInterface(() => {
                            sendToAndroid(fullAddr, "0", "0");
                        });
                    }
                });
            },
            width: '100%',
            height: '100%'
        }).embed(document.getElementById('wrap'));
    };
</script>
</body>
</html>